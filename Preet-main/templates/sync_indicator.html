<!-- Real-time Sync Indicator -->
<div id="syncIndicator" class="position-fixed" style="top: 20px; right: 20px; z-index: 1050; display: none;">
    <div class="alert alert-info border-0 shadow-sm d-flex align-items-center">
        <div class="spinner-border spinner-border-sm me-2" role="status">
            <span class="visually-hidden">Syncing...</span>
        </div>
        <span id="syncMessage">Syncing to Google Drive...</span>
    </div>
</div>

<!-- Sync Success Notification -->
<div id="syncSuccess" class="position-fixed" style="top: 20px; right: 20px; z-index: 1050; display: none;">
    <div class="alert alert-success border-0 shadow-sm d-flex align-items-center">
        <i class="fas fa-check-circle me-2"></i>
        <span>Data synced to Google Drive!</span>
    </div>
</div>

<script>
// Real-time sync status functions
function showSyncIndicator(message = 'Syncing to Google Drive...') {
    document.getElementById('syncMessage').textContent = message;
    document.getElementById('syncIndicator').style.display = 'block';
    document.getElementById('syncSuccess').style.display = 'none';
}

function hideSyncIndicator() {
    document.getElementById('syncIndicator').style.display = 'none';
}

function showSyncSuccess() {
    document.getElementById('syncIndicator').style.display = 'none';
    document.getElementById('syncSuccess').style.display = 'block';
    
    // Auto-hide after 3 seconds
    setTimeout(() => {
        document.getElementById('syncSuccess').style.display = 'none';
    }, 3000);
}

function showSyncError(error) {
    document.getElementById('syncIndicator').style.display = 'none';
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'position-fixed alert alert-danger border-0 shadow-sm';
    errorDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1050;';
    errorDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>
        Sync failed: ${error}
    `;
    
    document.body.appendChild(errorDiv);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (errorDiv.parentNode) {
            errorDiv.remove();
        }
    }, 5000);
}

// Override all form submissions to show sync status
document.addEventListener('DOMContentLoaded', function() {
    // Intercept all form submissions for real-time feedback
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            // Only show sync for forms that save data (not search forms)
            const formId = form.id;
            if (formId === 'transactionForm' || formId === 'paymentForm' || 
                form.method.toLowerCase() === 'post') {
                showSyncIndicator();
            }
        });
    });
});

// Monitor network requests for API calls
if (window.fetch) {
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        const [url, options] = args;
        
        // Show sync indicator for API calls that modify data
        if (url.includes('/api/') && options && options.method === 'POST') {
            showSyncIndicator('Saving to Google Drive...');
        }
        
        return originalFetch.apply(this, args)
            .then(response => {
                if (url.includes('/api/') && options && options.method === 'POST') {
                    if (response.ok) {
                        showSyncSuccess();
                    } else {
                        showSyncError('Network error');
                    }
                }
                return response;
            })
            .catch(error => {
                if (url.includes('/api/') && options && options.method === 'POST') {
                    showSyncError(error.message);
                }
                throw error;
            });
    };
}
</script>